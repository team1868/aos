load("@rules_cc//cc:cc_binary.bzl", "cc_binary")
load("//aos/seasocks:gen_embedded.bzl", "gen_embedded")

gen_embedded(
    name = "gen_embedded",
    srcs = glob(
        include = ["www_defaults/**/*"],
        exclude = ["www/**/*"],
    ),
)

cc_binary(
    name = "image_streamer",
    srcs = ["image_streamer.cc"],
    args = [
        "--data_dir=frc/image_streamer/www",
    ],
    copts = [
        "-Wno-cast-align",
    ],
    data = [
        "//frc/image_streamer/www:files",
        "//frc/image_streamer/www:main_bundle.min.js",
    ],
    target_compatible_with = select({
        "@platforms//cpu:aarch64": [],
        "@platforms//cpu:x86_64": [],
        "//conditions:default": ["@platforms//:incompatible"],
    }) + [
        "@platforms//os:linux",
    ],
    visibility = ["//visibility:public"],
    deps = [
        ":gen_embedded",
        "//aos:configuration_fbs",
        "//aos:init",
        "//aos/events:glib_main_loop",
        "//aos/events:shm_event_loop",
        "//aos/network:connect_fbs",
        "//aos/network:web_proxy_fbs",
        "//aos/seasocks:seasocks_logger",
        "//frc/vision:vision_fbs",
        "//third_party:gstreamer",
        "//third_party/seasocks",
        "@com_github_google_flatbuffers//:flatbuffers",
        "@com_google_absl//absl/log",
        "@com_google_absl//absl/log:check",
        "@com_google_absl//absl/strings:str_format",
    ],
)
